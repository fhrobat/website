:root{
  --char-pop-max-delay: 200;
  --char-pop-duration: 5000;
  --char-fall-duration: 2000;
  --char-rise-duration: 1000;
}

/* =========================================================
   CLIPPING DENTRO LA COLUMN (NO SHIFT / NO SCROLLBAR)
   ========================================================= */

/* La column deve clippare tutto ciò che "esce" durante lo shake */
#gravity-zone{
  position: relative;
  overflow: hidden;   /* fallback */
  overflow: clip;     /* se supportato: clippa senza scrollbar */
  contain: paint;     /* isola il paint: lo shake non "invade" fuori */
}

/* Durante l’animazione: niente overflow-x (evita comparsa/scomparsa scrollbar) */
html.falling-mode,
html.falling-mode body{
  overflow-x: hidden; /* oppure clip */
}

/* Se la tua column è un flex item, questo spesso elimina micro-overflow */
#gravity-zone{
  min-width: 0;
}

/* =========================================================
   ANIMAZIONI CHAR
   ========================================================= */

.fall-char{
  display: inline-block;
  transform: translate3d(0,0,0);
  will-change: transform, opacity;
  backface-visibility: hidden;
}

.char-pop{
  animation: charQuake calc(var(--char-pop-duration) * 1ms)
    steps(1, end) both;
  transform-origin: center center;
}

@keyframes charQuake{
  0%  { transform: translate3d(0,0,0) rotate(0deg); }

  10% { transform: translate3d(var(--qx1), var(--qy1),0) rotate(var(--qr1)); }
  20% { transform: translate3d(var(--qx2), var(--qy2),0) rotate(var(--qr2)); }
  30% { transform: translate3d(var(--qx3), var(--qy3),0) rotate(var(--qr3)); }
  40% { transform: translate3d(var(--qx4), var(--qy4),0) rotate(var(--qr4)); }
  50% { transform: translate3d(var(--qx5), var(--qy5),0) rotate(var(--qr5)); }
  60% { transform: translate3d(var(--qx6), var(--qy6),0) rotate(var(--qr6)); }
  70% { transform: translate3d(var(--qx7), var(--qy7),0) rotate(var(--qr7)); }
  80% { transform: translate3d(var(--qx8), var(--qy8),0) rotate(var(--qr8)); }
  90% { transform: translate3d(var(--qx9), var(--qy9),0) rotate(var(--qr9)); }

  100%{ transform: translate3d(0,0,0) rotate(0deg); }
}



.char-fall-active{
  animation: charFall calc(var(--char-fall-duration) * 1ms)
    cubic-bezier(.22,.61,.36,1) forwards;
}

@keyframes charFall{
  from { transform: translate3d(0,0,0) rotate(0deg); opacity: 1; }
  to   { transform: translate3d(0,var(--y),0) rotate(var(--r)); opacity: 1; }
}

.char-rise-active{
  animation: charRise calc(var(--char-rise-duration) * 1ms)
    cubic-bezier(.22,.61,.36,1) forwards;
}

@keyframes charRise{
  from { transform: translate3d(0,var(--y),0) rotate(var(--r)); opacity: 1; }
  to   { transform: translate3d(0,0,0) rotate(0deg); opacity: 1; }
}

@media (prefers-reduced-motion: reduce){
  .char-pop, .char-fall-active, .char-rise-active{ animation: none !important; }
}
