:root{
  --char-pop-max-delay: 500;
  --char-pop-duration: 1000;
  --char-fall-duration: 2000;
  --char-rise-duration: 1000;
}

/* =========================================================
   CLIPPING DENTRO LA COLUMN (NO SHIFT / NO SCROLLBAR)
   ========================================================= */

/* La column deve clippare tutto ciò che "esce" durante lo shake */
#gravity-zone{
  position: relative;
  overflow: hidden;   /* fallback */
  overflow: clip;     /* se supportato: clippa senza scrollbar */
  contain: layout paint;     /* isola il paint: lo shake non "invade" fuori */
}

/* Durante l’animazione: niente overflow-x (evita comparsa/scomparsa scrollbar) */
html.falling-mode,
html.falling-mode body{
  overflow-x: hidden; /* oppure clip */
}

/* Se la tua column è un flex item, questo spesso elimina micro-overflow */
#gravity-zone{
  min-width: 0;
}

/* =========================================================
   ANIMAZIONI CHAR
   ========================================================= */

.fall-char{
  display: inline-block;
  transform: translate3d(0,0,0);
  will-change: transform, opacity;
  backface-visibility: hidden;
}

.char-pop{
  animation: charQuakeX calc(var(--char-pop-duration) * 1ms)
    steps(1, end) both;
  transform-origin: center center;
}

@keyframes charQuakeX{
  0%  { transform: translate3d(0,0,0); }

  5%  { transform: translate3d(var(--shake-x),0,0); }
  10% { transform: translate3d(calc(-1 * var(--shake-x)),0,0); }
  15% { transform: translate3d(var(--shake-x),0,0); }
  20% { transform: translate3d(calc(-1 * var(--shake-x)),0,0); }
  25% { transform: translate3d(var(--shake-x),0,0); }
  30% { transform: translate3d(calc(-1 * var(--shake-x)),0,0); }
  35% { transform: translate3d(var(--shake-x),0,0); }
  40% { transform: translate3d(calc(-1 * var(--shake-x)),0,0); }
  45% { transform: translate3d(var(--shake-x),0,0); }
  50% { transform: translate3d(calc(-1 * var(--shake-x)),0,0); }
  55% { transform: translate3d(var(--shake-x),0,0); }
  60% { transform: translate3d(calc(-1 * var(--shake-x)),0,0); }
  65% { transform: translate3d(var(--shake-x),0,0); }
  70% { transform: translate3d(calc(-1 * var(--shake-x)),0,0); }
  75% { transform: translate3d(var(--shake-x),0,0); }
  80% { transform: translate3d(calc(-1 * var(--shake-x)),0,0); }
  85% { transform: translate3d(var(--shake-x),0,0); }
  90% { transform: translate3d(calc(-1 * var(--shake-x)),0,0); }
  95% { transform: translate3d(var(--shake-x),0,0); }

  100%{ transform: translate3d(0,0,0); }
}




.char-fall-active{
  animation: charFall calc(var(--char-fall-duration) * 1ms)
    cubic-bezier(.22,.61,.36,1) forwards;
}

@keyframes charFall{
  from { transform: translate3d(0,0,0) rotate(0deg); opacity: 1; }
  to   { transform: translate3d(0,var(--y),0) rotate(var(--r)); opacity: 1; }
}

.char-rise-active{
  animation: charRise calc(var(--char-rise-duration) * 1ms)
    cubic-bezier(.22,.61,.36,1) forwards;
}

@keyframes charRise{
  from { transform: translate3d(0,var(--y),0) rotate(var(--r)); opacity: 1; }
  to   { transform: translate3d(0,0,0) rotate(0deg); opacity: 1; }
}

@media (prefers-reduced-motion: reduce){
  .char-pop, .char-fall-active, .char-rise-active{ animation: none !important; }
}
